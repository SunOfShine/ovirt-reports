<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="BR22B_system_overview" language="groovy" pageWidth="690" pageHeight="585" orientation="Landscape" whenNoDataType="AllSectionsNoDetail" columnWidth="690" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0">
	<property name="ireport.jasperserver.reportUnit" value="/Resources/embedded_reports/host_os_break_down_BR22"/>
	<property name="ireport.jasperserver.url" value="http://localhost:8080/ovirt-reports/services/repository"/>
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="style1">
		<conditionalStyle>
			<conditionExpression><![CDATA[($V{PAGE_NUMBER} % 2) == 0]]></conditionExpression>
			<style mode="Opaque" backcolor="#F2F3F9"/>
		</conditionalStyle>
	</style>
	<parameter name="active_hosts_select" class="java.lang.String">
		<defaultValueExpression><![CDATA["AND delete_date IS NULL"]]></defaultValueExpression>
	</parameter>
	<parameter name="P_DataCenter_ID" class="java.lang.String">
		<parameterDescription><![CDATA[Select a DataCenter]]></parameterDescription>
		<defaultValueExpression><![CDATA["00000000-0000-0000-0000-000000000000"]]></defaultValueExpression>
	</parameter>
	<parameter name="P_Cluster_ID" class="java.lang.String">
		<parameterDescription><![CDATA[Select a Cluster]]></parameterDescription>
		<defaultValueExpression><![CDATA["00000000-0000-0000-0000-000000000000"]]></defaultValueExpression>
	</parameter>
	<parameter name="P_Period" class="java.lang.String">
		<parameterDescription><![CDATA[Period]]></parameterDescription>
		<defaultValueExpression><![CDATA["Quarterly"]]></defaultValueExpression>
	</parameter>
	<parameter name="P_Dates" class="java.lang.String">
		<parameterDescription><![CDATA[Enter Period Month]]></parameterDescription>
		<defaultValueExpression><![CDATA["April 2019"]]></defaultValueExpression>
	</parameter>
	<parameter name="REPORT_NAME" class="java.lang.String" isForPrompting="false"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["C:\\Program Files\\jasperserver-pro-3.7\\"]]></defaultValueExpression>
	</parameter>
	<parameter name="P_Start_Date" class="java.lang.String">
		<defaultValueExpression><![CDATA["01/01/2000"]]></defaultValueExpression>
	</parameter>
	<parameter name="P_End_Date" class="java.lang.String">
		<defaultValueExpression><![CDATA["01/01/2000"]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[-- Datacenter aggregation level
--------
-- BR22 - Hosts Count by OS Type versus OS Version
-- Datacenter aggregation level
--------
-- BR22 - Hosts Count by OS Type versus OS Version

select distinct the_date, coalesce(os_type,max(os_type) over (partition by 1),'') as os_type, host_count
FROM   (SELECT   history_datetime,
			     coalesce(v3_0_host_configuration_view.host_os, 'Unknown') as os_type,
			     COUNT(DISTINCT v3_0_host_configuration_view.host_id) AS host_count

		FROM    v3_0_host_daily_history_view
				INNER JOIN v3_0_host_configuration_view
  				ON (v3_0_host_configuration_view.history_id = v3_0_host_daily_history_view.host_configuration_version)

		WHERE
		v3_0_host_configuration_view.cluster_id in (SELECT v3_0_cluster_configuration_view.cluster_id
									 FROM v3_0_cluster_configuration_view
			  						 WHERE v3_0_cluster_configuration_view.datacenter_id = cast($P{P_DataCenter_ID} as uuid))
		AND v3_0_host_configuration_view.cluster_id = CASE $P{P_Cluster_ID}
								 WHEN '11111111-1111-1111-1111-111111111111' then v3_0_host_configuration_view.cluster_id
								 ELSE cast($P{P_Cluster_ID} as uuid)
									 END
		AND history_datetime >= cast($P{P_Start_Date} as timestamp)
		AND history_datetime < cast($P{P_End_Date} as date) + interval '1 day'
		$P!{active_hosts_select}
		GROUP BY history_datetime, coalesce(v3_0_host_configuration_view.host_os, 'Unknown')) a right outer join calendar b on (a.history_datetime = b.the_date)
where the_date >= cast($P{P_Start_Date} as date)
      AND the_date < cast($P{P_End_Date} as date) + interval '1 day'
group by the_date, os_type, host_count
order by the_date]]>
	</queryString>
	<field name="the_date" class="java.sql.Date"/>
	<field name="os_type" class="java.lang.String"/>
	<field name="host_count" class="java.lang.Long"/>
	<title>
		<band height="358" splitType="Stretch">
			<timeSeriesChart>
				<chart evaluationTime="Report" hyperlinkType="ReportExecution" hyperlinkTarget="Blank" customizerClass="com.ovirt.reports.jasper.TimelineChartCustomizer" theme="ReportsLineBarChartTheme">
					<reportElement mode="Opaque" x="1" y="0" width="690" height="358"/>
					<box>
						<pen lineWidth="1.0" lineColor="#3C617F"/>
						<topPen lineWidth="1.0" lineColor="#3C617F"/>
						<leftPen lineWidth="2.0" lineColor="#3C617F"/>
						<bottomPen lineWidth="1.0" lineColor="#3C617F"/>
						<rightPen lineWidth="1.0" lineColor="#3C617F"/>
					</box>
					<chartTitle color="#3A5E7E">
						<font fontName="DejaVu Sans"/>
						<titleExpression><![CDATA["Host OS Break Down"]]></titleExpression>
					</chartTitle>
					<chartSubtitle>
						<font fontName="DejaVu Sans"/>
					</chartSubtitle>
					<chartLegend position="Bottom">
						<font fontName="DejaVu Sans"/>
					</chartLegend>
					<hyperlinkParameter name="_report">
						<hyperlinkParameterExpression><![CDATA["/Reports/Executive/host_os_break_down_BR22"]]></hyperlinkParameterExpression>
					</hyperlinkParameter>
					<hyperlinkParameter name="active_hosts_select">
						<hyperlinkParameterExpression><![CDATA[$P{active_hosts_select}]]></hyperlinkParameterExpression>
					</hyperlinkParameter>
					<hyperlinkParameter name="P_DataCenter_ID">
						<hyperlinkParameterExpression><![CDATA[$P{P_DataCenter_ID}]]></hyperlinkParameterExpression>
					</hyperlinkParameter>
					<hyperlinkParameter name="P_Cluster_ID">
						<hyperlinkParameterExpression><![CDATA[$P{P_Cluster_ID}]]></hyperlinkParameterExpression>
					</hyperlinkParameter>
					<hyperlinkParameter name="P_Period">
						<hyperlinkParameterExpression><![CDATA[$P{P_Period}]]></hyperlinkParameterExpression>
					</hyperlinkParameter>
					<hyperlinkParameter name="P_Dates">
						<hyperlinkParameterExpression><![CDATA[$P{P_Dates}]]></hyperlinkParameterExpression>
					</hyperlinkParameter>
					<hyperlinkParameter name="P_Start_Date">
						<hyperlinkParameterExpression><![CDATA[$P{P_Start_Date}]]></hyperlinkParameterExpression>
					</hyperlinkParameter>
					<hyperlinkParameter name="P_End_Date">
						<hyperlinkParameterExpression><![CDATA[$P{P_End_Date}]]></hyperlinkParameterExpression>
					</hyperlinkParameter>
				</chart>
				<timeSeriesDataset>
					<timeSeries>
						<seriesExpression><![CDATA[$F{os_type}]]></seriesExpression>
						<timePeriodExpression><![CDATA[$F{the_date}]]></timePeriodExpression>
						<valueExpression><![CDATA[$F{host_count}]]></valueExpression>
						<itemHyperlink>
							<hyperlinkTooltipExpression><![CDATA[$F{os_type} + ", " + $F{host_count}.toString()]]></hyperlinkTooltipExpression>
						</itemHyperlink>
					</timeSeries>
				</timeSeriesDataset>
				<timeSeriesPlot isShowShapes="false">
					<plot labelRotation="-45.0"/>
					<timeAxisLabelExpression><![CDATA["Date"]]></timeAxisLabelExpression>
					<timeAxisFormat>
						<axisFormat labelColor="#666666">
							<labelFont>
								<font fontName="DejaVu Sans"/>
							</labelFont>
							<tickLabelFont>
								<font fontName="DejaVu Sans"/>
							</tickLabelFont>
						</axisFormat>
					</timeAxisFormat>
					<valueAxisLabelExpression><![CDATA["#Active Hosts"]]></valueAxisLabelExpression>
					<valueAxisFormat>
						<axisFormat labelColor="#666666">
							<labelFont>
								<font fontName="DejaVu Sans"/>
							</labelFont>
							<tickLabelFont>
								<font fontName="DejaVu Sans"/>
							</tickLabelFont>
						</axisFormat>
					</valueAxisFormat>
				</timeSeriesPlot>
			</timeSeriesChart>
		</band>
	</title>
</jasperReport>
